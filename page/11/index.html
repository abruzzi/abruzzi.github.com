
<!DOCTYPE html>
<!--[if IEMobile 7 ]><html class="no-js iem7"><![endif]-->
<!--[if lt IE 9]><html class="no-js lte-ie8"><![endif]-->
<!--[if (gt IE 8)|(gt IEMobile 7)|!(IEMobile)|!(IE)]><!--><html class="no-js" lang="en"><!--<![endif]-->
<head>
  <meta charset="utf-8">
  <title>I code it</title>
  <meta name="author" content="Qiu Juntao">

  
  <meta name="description" content="background 元旦放假前，team的同事们想要一起学习一些技术，然后一起做些小东西，有人提到将物理墙上的卡，通过手机拍照，识别出其中的卡号，然后与电子墙同步状态。这是一个非常有意思的主题，会涉及到很多方面的知识，其实有好几个topic，只不过我对人工智能/机器学习等比较有兴趣而已， &hellip;">
  

  <!-- http://t.co/dKP3o1e -->
  <meta name="HandheldFriendly" content="True">
  <meta name="MobileOptimized" content="320">
  <meta name="viewport" content="width=device-width, initial-scale=1">

  
  <link rel="canonical" href="http://abruzzi.github.com/page/11">
  <link href="/favicon.png" rel="icon">
  <link href="/stylesheets/screen.css" media="screen, projection" rel="stylesheet" type="text/css">
  <link href="/atom.xml" rel="alternate" title="I code it" type="application/atom+xml">
  <script src="/javascripts/modernizr-2.0.js"></script>
  <script src="/javascripts/libs/jquery.min.js"></script>
  <script>!window.jQuery && document.write(unescape('%3Cscript src="./javascripts/lib/jquery.min.js"%3E%3C/script%3E'))</script>
  <script src="/javascripts/octopress.js" type="text/javascript"></script>
  <!--Fonts from Google"s Web font directory at http://google.com/webfonts -->
<link href="http://fonts.gmirror.org/css?family=PT+Serif:regular,italic,bold,bolditalic" rel="stylesheet" type="text/css">
<link href='http://fonts.gmirror.org/css?family=Open+Sans' rel='stylesheet' type='text/css'>
<link href='http://fonts.gmirror.org/css?family=Fjalla+One' rel='stylesheet' type='text/css'>
  
  <script type="text/javascript">
    var _gaq = _gaq || [];
    _gaq.push(['_setAccount', 'UA-28217566-1']);
    _gaq.push(['_trackPageview']);

    (function() {
      var ga = document.createElement('script'); ga.type = 'text/javascript'; ga.async = true;
      ga.src = ('https:' == document.location.protocol ? 'https://' : 'http://') + 'stats.g.doubleclick.net/dc.js';
      var s = document.getElementsByTagName('script')[0]; s.parentNode.insertBefore(ga, s);
    })();
  </script>


</head>

<body   class="collapse-sidebar sidebar-footer" >
  <header role="banner"><hgroup>
  <h1><a href="/">I code it</a></h1>
  
    <h2>Code and Life</h2>
  
</hgroup>

</header>
  <nav role="navigation"><ul class="subscription" data-subscription="rss">
  <li><a href="/atom.xml" rel="subscribe-rss" title="subscribe via RSS">RSS</a></li>
  
</ul>
  
<form action="https://google.com/search" method="get">
  <fieldset role="search">
    <input type="hidden" name="q" value="site:abruzzi.github.com" />
    <input class="search" type="text" name="q" results="0" placeholder="Search"/>
  </fieldset>
</form>
  
<ul class="main-navigation">
  <li><a href="/">文章</a></li>
  <li><a href="/blog/archives">文章归档</a></li>
  <li><a href="/publish">出版物</a></li>
  <li><a href="/about-me">关于</a></li>
</ul>
</nav>
  <div id="main">
    <div id="content">
      <div class="blog-index">
  
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/k-nearest-neighbour/">K-nearest-neighbour算法简介及示例</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-03T15:46:00+08:00" pubdate data-updated="true">Jan 3<span>rd</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>background</h3>

<p>元旦放假前，team的同事们想要一起学习一些技术，然后一起做些小东西，有人提到将物理墙上的卡，通过手机拍照，识别出其中的卡号，然后与电子墙同步状态。这是一个非常有意思的主题，会涉及到很多方面的知识，其实有好几个topic，只不过我对人工智能/机器学习等比较有兴趣而已，所以就先自己研究下。</p>

<p>几天下来，关于数字识别的基本的流程已经清晰了，关于图片的预处理及边界标定等都差不多就绪了，剩下比较重要的是<strong>识别</strong>本身了。在这个过程中，遇到了一些很有意思的算法，我自己也花费了好几天才弄明白，所以整理了一下，这一篇先介绍下第一个，也是最简单最好用的KNN算法。</p>

<h3>K-nearest-neighbour简介</h3>

<p>KNN是机器学习中<strong>最简单</strong>的一种无值守的学习方法，但是在实际场景中，效果却经常<strong>非常好</strong>。一般来说，在样本较多，分布均匀的空间中，KNN会收到很好的效果。但是由于KNN会计算空间中的每个点与需要标定的点的距离(甚至需要计算额外的权重信息)，所以计算量会较大。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>假设所有的点都均匀的分布在一个平面内，此时的平面密度(单位范围内的点的个数)非常大，而每个子平面内的点的分布与所有点在整个平面内的分布相当。在子平面S中，有一个点Y，则离点X(to be classified)最近的Y很可能与Y同在子平面S中。</span></code></pre></td></tr></table></div></figure>


<p>比如取出空间中与X距离最近的有5个点(K=5)，其中3个属于C1类，2个属于C2类，则根据少数服从多数原则，X点被归类为C1.这样的一个缺点就是如果空间内的点分布不均匀，那么会有一些误差，如果上面这个场景经常出现，那么分类会越来越偏离(有一个偏心的硬币，投掷100,000次，有90,000次正面)。这样就有引入了对KNN的另一个扩展方式，加入权重的KNN：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>当然这种形式的KNN不是很精确，由此引申出了带权重的KNN：可以为每个点都赋予一个权值，每个权值与新的点X的距离有关，通常会取距离的倒数，这样与X最近的点有较高的权重，而较远的点具有较低的权重，这样在投票(voting)阶段可以相对的提高精确度</span></code></pre></td></tr></table></div></figure>


<h3>KNN的一个python版本示例</h3>

<h4>背景(高斯分布)</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>import random
</span><span class='line'>
</span><span class='line'>def gauss_list(mu, sigma, count=100):
</span><span class='line'>    return [random.gauss(mu, sigma) for _ in range(count)]</span></code></pre></td></tr></table></div></figure>


<p>生成一个随机数数组，数组中的元素符合高斯分布，如</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>ran = gauss_list(-2, 1, 10)
</span><span class='line'>print ran</span></code></pre></td></tr></table></div></figure>


<p>运行结果如下：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>[-1.3277188634970218, -2.1034487392146817, -0.5924407591392826, -0.30376289085064045, -2.191337071105794, -1.9781081550478732, -3.7937155472105673, -2.538102349796847, -1.3728510997834549, -2.766669661625006]</span></code></pre></td></tr></table></div></figure>


<p>更进一步，我们可以用这种方式生成平面中的一些点，这些点可以根据分布情况分为两组，一组是以(-4,0)为重心的500个点，另一组是以(4,0)为重心的500个点：</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def gauss_cluster(center, stdDev, count=500):
</span><span class='line'>    return [(random.gauss(center[0], stdDev),
</span><span class='line'>             random.gauss(center[1], stdDev)) for _ in range(count)]
</span><span class='line'>
</span><span class='line'>def make_random_data():
</span><span class='line'>    return gauss_cluster((-4, 0), 1) + gauss_cluster((4, 0), 1)
</span><span class='line'>
</span><span class='line'>data = make_random_data()
</span></code></pre></td></tr></table></div></figure>


<h4>绘制高斯分布</h4>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>data = make_random_data()
</span><span class='line'>
</span><span class='line'>x = map(lambda x: x[0], data)
</span><span class='line'>y = map(lambda x: x[1], data)
</span><span class='line'>
</span><span class='line'>plt.clf()
</span><span class='line'>
</span><span class='line'>plt.scatter(x, y, c=x, vmin=0, vmax=20, s=35, alpha=0.75)
</span><span class='line'>plt.colorbar()
</span><span class='line'>plt.grid(True)
</span><span class='line'>
</span><span class='line'>plt.show()</span></code></pre></td></tr></table></div></figure>


<p>通过使用matplotlib的绘图功能，将make_random_data生成的点通过图形的方式展现，效果更加直观，图中的两个点集分别表示两个不同的类别。</p>

<p><img src="http://abruzzi.github.com/images/2013/01/gauss-distribution-resized.png" alt="image" /></p>

<h4>KNN</h4>

<p>我们定义KNN分类器，其中两点间的距离按照欧氏公式来求，先计算点集中离x点最近的k个点，然后取得对应的k个label，再按照label个数球max。</p>

<p>比如k=5时，求的的label集合为[&#8216;O&#8217;, &#8216;O&#8217;, &#8216;A&#8217;, &#8216;A&#8217;, &#8216;A&#8217;]，则我们认为这个点应该被分类为A(少数服从多数)。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>def euclidean_distance(x, y):
</span><span class='line'>    return math.sqrt(sum([(a-b)**2 for (a,b) in zip(x,y)]))
</span><span class='line'>
</span><span class='line'>def makeKNNClassifier(data, labels, k, distance):
</span><span class='line'>    def classify(x):
</span><span class='line'>        closestPoints = heapq.nsmallest(k, enumerate(data),
</span><span class='line'>                                        key=lambda y: distance(x, y[1]))
</span><span class='line'>        closestLabels = [labels[i] for (i, pt) in closestPoints]
</span><span class='line'>        return max(set(closestLabels), key=closestLabels.count)
</span><span class='line'>
</span><span class='line'>    return classify</span></code></pre></td></tr></table></div></figure>


<h4>测试一下</h4>

<p>创建1000个随机点，前500个分类为A(Apple)，后500个分类为O(Orange)，k值为3。</p>

<figure class='code'><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class=''><span class='line'>data = make_random_data()
</span><span class='line'>labels = ['A'] * 500 + ['O'] * 500
</span><span class='line'>
</span><span class='line'>fitter = makeKNNClassifier(data, labels, 3, euclidean_distance)
</span><span class='line'>
</span><span class='line'>print fitter((-3, 1))
</span><span class='line'>print fitter((4, 2))</span></code></pre></td></tr></table></div></figure>


<p>图中的两个红色的点分别为P1(-3, 1)和P2(4, 2)。它们都已经被正确的分类。</p>

<p><img src="http://abruzzi.github.com/images/2013/01/knn-plant-resized.png" alt="image" /></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2013/01/why-every-dev-should-try-mac-os/">为什么每个开发人员都应该使用Mac系统</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2013-01-01T22:41:00+08:00" pubdate data-updated="true">Jan 1<span>st</span>, 2013</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>为什么每个开发人员都应该使用Mac系统</h2>

<p>在使用了Mac系统大概10个月之后，我已经深深的喜欢上了在其上做开发的体验，精美的界面，人性化的设计，强大的硬件系统，安全而稳定的软件系统，下面我将会用Mac系统和Windows做一个简单的对比，最后会有一些推荐的工具列表。</p>

<h3>Mac系统的一些好处</h3>

<pre><code>1. 系统非常稳定，很少发生死机或者运行缓慢之类问题
2. 即使在休眠之后，也可以飞速(与windows相比)启动
3. 内置的命令行工具非常强大
4. 大量内置的优秀软件
</code></pre>

<p>基本上来说，Mac系统就是一个比Windows的UI漂亮，又比Linux的命令行好用的操作系统。苹果之前的广告说他们的系统是世界级的优秀系统，这一点毫无夸张，Mac OS确实是<strong>世界上最好</strong>的操作系统，没有之一。</p>

<p>个人感觉，使用Mac OS能明显提高开发效率，使得用于解决真正问题的时间提高，而折腾的时间减少，使用windows系统，有很多的时间是在与系统做斗争，或者在等待系统如蜗牛般的加载，说起windows的多任务简直就是笑话，而且有很多无耻的进程在甚至在任务管理器中都不能完全杀死，更不要提病毒之类的话题了。</p>

<p>人们使用计算机的一个典型过程应该是：<em>命令->响应</em>，如是循环，这也是用Mac系统的典型过程。但是使用windows的过程是这样的：<em>命令->等待->响应</em>，或者<strong>命令->死机->…</strong>。我有一台Thinkpad笔记本，4G内存/250G硬盘，Windows 7系统，按说配置还算可以，运行速度也勉强能接受，但是跟同级别硬件配置用来跑Mac系统的话，效率据保守估计会提高32倍。</p>

<p>我觉得对一个合格的开发人员来说，命令行技能，即使不是最重要的，也应该是第二重要的，Mac下的命令行非常好用，有很多shell可供选择，Linux用户可以没有任何学习曲线的转移到Mac的命令行中(bash)，如果觉得默认的bash不顺手，也可以很轻易的切换到zsh，csh之类，很多的Linux知识可以直接用在Mac上，毫无挫败感。</p>

<p><a href="http://http://abruzzi.github.com/images/2013/01/shell-mac.png"><img src="http://abruzzi.github.com/images/2013/01/shell-mac-resized.png" alt="image" /></a></p>

<p>Mac系统中内置了很多的软件，也有一些可以免费获得的优秀软件(下面列表中有很大一部分软件都是免费的)，很多人觉得Mac下什么软件都要收费，我觉得软件收费无可非议，每个软件都倾注了作者(一个或者多个)的大量心血，绝对是合情合理，特别是对于开发人员更是如此(但是，如果开发的软件如windows般垃圾而还要收费的话，那就让人忍不住要骂人了)。</p>

<h3>一些工具的推荐</h3>

<h4>编辑器</h4>

<p>编辑器几乎是开发人员每天接触最多的工具，也最能体现一个开发人员的品味和level，不过在Mac下有所有主流的编辑器，或者其替代品:</p>

<pre><code>1. GVim
2. Emacs
3. Sublime Text 2
</code></pre>

<p><a href="http://abruzzi.github.com/images/2013/01/vim-mac-dev.png"><img src="http://abruzzi.github.com/images/2013/01/vim-mac-dev-resized.png" alt="image" /></a></p>

<h4>IDE</h4>

<p>说实话，我并不喜欢使用IDE，最开始是因为在纯命令行下工作，没有可用的IDE，后来是因为它在一定程度上阻碍了初学者对编译/链接/加载整个过程的理解(所以现在还是不建议初学者直接从IDE开始学习编程)，再后来开始使用jetbrains系列的IDE，除了体积较重，偶尔会有焦点缺失的bug外，基本完美，开发效率会非常高，<strong>世界顶级，没有之一</strong> (下面里表中前两者都要收费，而且价格不菲，但是一分钱一分货):</p>

<pre><code>1. Intellij Idea (Java)
2. Rubymine (Ruby)
3. Eclipse (全能，理论上你可以将器配置成任何语言的IDE)
</code></pre>

<h4>电子书阅读</h4>

<p>电子书阅读我需要一个可以记录上次读到了什么地方，最近打开的书单之类的功能，正好preview都提供，因此也没有专门去找过有没有更好用的:</p>

<pre><code>1. Preview (图片，PDF等都可以preview，很好用)
</code></pre>

<h4>笔记</h4>

<p>个人经验，经常性的将实际开发中遇到的问题，好的设计方式，好的测试用例等记录下来是一个非常好的学习方式，另外在工作的时候，会看到一些非常精彩的文章，可以通过(read it later)记录下来，然后同步到自己的笔记本中，回家或者是休息的时候再看:</p>

<pre><code>1. Evernote
2. Pocket (read it later)
</code></pre>

<h4>同步</h4>

<p>我是一个不折不扣的同步控，我的dropbox中的内容在Mac Book，iPhone和windows机器上都会同步，很多资料找起来会非常方便，比如一些经典的书籍，一些图片素材等，我都会在dropbox中放一份，如果别人需要也很容易分享:</p>

<pre><code>1. Dropbox
2. Box
3. Google Drive
</code></pre>

<p>本来我还打算写一篇比如《将Mac搭建为一个开发环境》之类的文章，然后列提纲的时候发现无物可写，人家本来就是一个高效的开发环境。比如Terminal/Spotlight/Finder，再加上一个编辑器就完全可以启动了。所以就简单的整理了下我常用的软件列表，以供参考。</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/12/%E6%88%91%E7%9A%842012/">我的2012</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-12-30T00:00:00+08:00" pubdate data-updated="true">Dec 30<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p><p>毫无疑问，2012年是自我工作以来过的最为充实的一年。我学会了新的编程语言ruby，然后学会了与之相关的两个框架：<a href="http://rubyonrails.org/">rails</a>和<a href="http://www.sinatrarb.com/">sinatra</a>。以及很多DevOps的工具，如<a href="http://www.opscode.com/chef/">chef</a>, <a href="http://vagrantup.com/">vagrant</a> 之类。</p> <p><a href="http://abruzzi.github.com/images/2012/12/Screen-Shot-2012-12-13-at-11.05.58-PM4.png"><img style="background-image: none; display: inline" title="Screen Shot 2012-12-13 at 11.05.58 PM" border="0" alt="Screen Shot 2012-12-13 at 11.05.58 PM" src="http://abruzzi.github.com/images/2012/12/Screen-Shot-2012-12-13-at-11.05.58-PM_thumb.png" width="644" height="458" /></a></p> <p>学习并实践了在年初还觉得很神秘而不可思议的TDD，学习了3种测试框架(<a href="http://rspec.info/">rspec</a>, <a href="http://pivotal.github.com/jasmine/">jasmine</a>, junit)以及一些基本的测试方法。但是在积极分享这一点上做得并不好，虽然也有几篇博客在记录学习的心得，但是秋冬两季在icodeit上一篇博客都没有，仅仅在github上有<a href="http://abruzzi.github.com">几篇零散的草稿</a>。</p> <p>在新的环境中，有太多的东西要学习，在刚开始的时候，很难理解每个工具背后的原理或者更深层次的技术等，经过差不多半年的使用之后，才慢慢领会。理解工具，框架的背后的机制和原理后，实际工作的压力才略微减小了些。</p> <p>在ThoughtWorks西安office开办了将近1个月的乒乓球训练课(和何大师一起)，每周两节课，每节课大概有6+个同事参加，后来还想举办个ThoughtWorks首届男女混双，一直没有实施。西安office的球桌/乒乓球室已经相当专业。</p> <p><a href="http://abruzzi.github.com/images/2012/12/2012-07-22-20.20.19.jpg"><img style="background-image: none; display: inline" title="2012-07-22 20.20.19" border="0" alt="2012-07-22 20.20.19" src="http://abruzzi.github.com/images/2012/12/2012-07-22-20.20.19_thumb.jpg" width="644" height="483" /></a></p> <p>我在7月和10月分享过两个session(说文解字，高效编辑-vim). 下图是说文解字那个session的一张照片。session是对内的presentation，主要目的是分享知识，很多同事会选择技术作为主体，当然不局限于此。我之前很少在公共场合说话，但是通过自己push自己去讲session，一来可以将学习的东西巩固(由于是要讲给别人，所以必然会精心准备，这样印象会更深刻)，二来可以锻炼自己的交流能力。而且从听众的feedback可以知道哪些地方可以改进等。</p> <p><a href="http://abruzzi.github.com/images/2012/12/2012-07-05-13.53.22.jpg"><img style="background-image: none; display: inline" title="2012-07-05 13.53.22" border="0" alt="2012-07-05 13.53.22" src="http://abruzzi.github.com/images/2012/12/2012-07-05-13.53.22_thumb.jpg" width="644" height="484" /></a></p> <p>11月到12去墨尔本出差了3周，在客户现场用英文做过一个关于西安team日常工作方式的的presentation。这是我第一次出国，也是第一次用英文做presentation，虽然比较简短，但是我很高兴：我在3月底在上项目的时候，我们的BA给我介绍项目情况的时候，我还需要别人翻译。</p> <p><a href="http://abruzzi.github.com/images/2012/12/2012-11-18-11.09.15-2.jpg"><img style="background-image: none; display: inline" title="2012-11-18 11.09.15-2" border="0" alt="2012-11-18 11.09.15-2" src="http://abruzzi.github.com/images/2012/12/2012-11-18-11.09.15-2_thumb.jpg" width="644" height="484" /></a></p> <p>11月之后，终于有一点自己的时间来整理项目中学到的新的JavaScript经验和知识，为我的<a href="http://www.icodeit.org/javascript%E5%86%85%E6%A0%B8/">《JavaScript核心概念及实践》</a>添加了两章的内容(前端MVC和测试)。</p> <p>生活方面，运动量明显减少，整个2012，爬过三次山，第一次是和田彦强夫妇去沣峪口，第二次是和胡凯，王欢，孙曼思等去太平峪，第三次是和team一起去九龙潭。在10月左右给孙曼思买了一张捷安特的山地车，一起出去骑过两次，一次是从绿地到大雁塔，另一次是绿地到草滩，当我们计划骑行秦岭的时候，气温已经冷到不适宜骑行了。平时的话，虽然会和同事们打打乒乓球或者羽毛球，但是运动量都太小。</p> <p><a href="http://abruzzi.github.com/images/2012/12/2012-11-03-11.35.08.jpg"><img style="background-image: none; display: inline" title="2012-11-03 11.35.08" border="0" alt="2012-11-03 11.35.08" src="http://abruzzi.github.com/images/2012/12/2012-11-03-11.35.08_thumb.jpg" width="364" height="484" /></a></p> <p>另一方面，2012年的大部分时间都坚持吃素，下图是孙曼思和我做的豆腐：</p> <p><a href="http://abruzzi.github.com/images/2012/12/Screen-Shot-2012-10-15-at-9.17.41-PM.png"><img style="background-image: none; display: inline" title="Screen Shot 2012-10-15 at 9.17.41 PM" border="0" alt="Screen Shot 2012-10-15 at 9.17.41 PM" src="http://abruzzi.github.com/images/2012/12/Screen-Shot-2012-10-15-at-9.17.41-PM_thumb.png" width="644" height="434" /></a></p> <p>书读了差不多20本，有余华，贾平凹，戴厚英的小说，有些技术相关的，另外一些是历史/政治方面的。因为就我目前所接触到的和所能想到的，技术很难由读书来提升，我更多的是花一些时间去读一些blog或者相对较为简短的文章来学习技术，然后进行一些实践来巩固。</p> <p><a href="http://abruzzi.github.com/images/2012/12/card2-contours.jpg"><img style="background-image: none; display: inline" title="card2-contours" border="0" alt="card2-contours" src="http://abruzzi.github.com/images/2012/12/card2-contours_thumb.jpg" width="644" height="484" /></a></p> <p>最后这张图是上周末我们team的一个idea的初步实现：将墙上的卡用手机扫描，然后将卡号分析出来并同步到服务器，然后向jira查询卡的状态等。我用opencv，花了大概两天，终于可以将数字找到并从卡上抠出，但是当涉及到KNN去识别图片中的数字时，遇到了一点难题，很可能会拖到明年才能完成……</p></p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/11/git-squash-localcommits/">Git Squash Localcommits</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-11-07T10:54:00+08:00" pubdate data-updated="true">Nov 7<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>There is a common scenario: we have lots of local commits related with a certain feature or a big
bug, after all the works done, we want to combine them together. The git provides a handy way to do
this job: <em>git rebase</em></p>

<p>I&#8217;ll take the following case as an example, say, I&#8217;ve got 3 commits locally and they are all about
a restyling of some page.</p>

<p><code>$ git st</code></p>

<pre><code># On branch master
# Your branch is ahead of 'origin/master' by 3 commits.
#
nothing to commit (working directory clean)
</code></pre>

<p>Details:</p>

<p><code>$ git log</code></p>

<pre><code>commit 4e7e1ac7e7e77ae4404843ed96b9f881f969b836
Author: Qiu Juntao &lt;juntao.qiu@gmail.com&gt;
Date:   Tue Nov 6 16:49:59 2012 +0800

    RCA-410 new search form style only apply to search result page.

commit 385cec1f22f432c03ea96b5c927f89b3747e82fb
Author: Qiu Juntao &lt;juntao.qiu@gmail.com&gt;
Date:   Tue Nov 6 14:21:50 2012 +0800

    RCA-410 re-style search form area.

commit b9694db0b0fb100bfa5f967480188bf05ad538b4
Author: Qiu Juntao &lt;juntao.qiu@gmail.com&gt;
Date:   Tue Nov 6 10:33:07 2012 +0800

    RCA-410 restyling search form.

commit 866375c7d805e19f963319fb558f1b16f7daf15b
Author: John abruzzi &lt;juntao.qiu@gmail.com&gt;
Date:   Mon Nov 5 14:06:16 2012 +0800

    RCA-625. Add the embeded video feature toggle into casa feature-config file.
</code></pre>

<p>I have 3 commits after the very commit <em>866375c7d805e19f963319fb558f1b16f7daf15b</em>, and then I&#8217;ll use
rebase in interactive mode, by the option <em>-i</em> appended.</p>

<p><code>$ git rebase -i HEAD~3</code></p>

<pre><code>pick b9694db0b RCA-410 restyling search form. Pair: Yameng &amp; Juntao
pick 385cec1f2 RCA-410 re-style search form area. pair:juntao
pick 4e7e1ac7e RCA-410 new search form style only apply to search result page. pair:Juntao
</code></pre>

<p>There are a few command provided, I&#8217;ll use <em>squash</em> by now, since I want to squash the following 2 commits
into the first one, so simply change the <em>pick</em> into <em>squash</em></p>

<pre><code>pick b9694db0b RCA-410 restyling search form. Pair: Yameng &amp; Juntao
squash 385cec1f2 RCA-410 re-style search form area. pair:juntao
squash 4e7e1ac7e RCA-410 new search form style only apply to search result page. pair:Juntao
</code></pre>

<p>After that, save the popuped editor(vi in my local machinel), and change the generated comments message into</p>

<pre><code>RCA-410 restyling search form, applied to search results and pdp. Pair: Yameng &amp; Juntao
</code></pre>

<p>and then save and quit the editor, we&#8217;ll see the following message:</p>

<p><code>$ git st</code></p>

<pre><code># On branch master
# Your branch is ahead of 'origin/master' by 1 commit.
#
nothing to commit (working directory clean)
</code></pre>

<p>And the history is more clear like this:
<code>$ git log</code></p>

<pre><code>commit 8ff8a0e015b6ebe7bcd5434f25ed789dee2d5f1e
Author: Qiu Juntao &lt;juntao.qiu@gmail.com&gt;
Date:   Tue Nov 6 10:33:07 2012 +0800

    RCA-410 restyling search form, applied to search results and pdp.

commit 866375c7d805e19f963319fb558f1b16f7daf15b
Author: John abruzzi &lt;juntao.qiu@gmail.com&gt;
Date:   Mon Nov 5 14:06:16 2012 +0800
    RCA-625. Add the embeded video feature toggle into casa feature-config file.
</code></pre>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/using-ssh-forward-to-get-out-of-stupid-wall/">Using Ssh Forward to Get Out of Stupid Wall</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-25T22:59:00+08:00" pubdate data-updated="true">Oct 25<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Generate the public and private key pair</h2>

<p>This step is quite strightforward, just generate the keys by using ssh-keygen:</p>

<pre><code>$ ssh-keygen #specify the key file name (I use the id_ plus remote site hostname)
</code></pre>

<p>then you&#8217;ll get 2 keys locally, you can do this step in any place, but people do it
on their home-dir/.ssh, after the creation, you need to change the mask of the key file:</p>

<pre><code>$ chmod 600 id_site
</code></pre>

<h2>Put the public key remotely</h2>

<p>Okay, once the key is generated, we can simply put the publick key to remote site, and we
don&#8217;t need to type password any more:</p>

<pre><code>$ scp id_site.pub user@remote:
</code></pre>

<p>Note the colon at the end of the command above, login to remote server</p>

<pre><code># cat id_site.pub &gt;&gt; .ssh/authorized_keys
# rm id_site.pub
</code></pre>

<p>Then go back local machine, and we&#8217;re done</p>

<h2>SSH forward</h2>

<p>Now we can simply login the remote server by using the private key just generated:</p>

<pre><code>$ ssh -i id_site user@remote
</code></pre>

<p>You then probably be noticed to add the key to system key chain, it is on Mac. And we now don&#8217;t
need to type the password manually. So let&#8217;s go a little bit further:</p>

<pre><code>$ ssh -N -i id_site -l 15100:localhost:15100 user@remote
</code></pre>

<p>Then you can access the localhost:1500 port on remote machine BY using the local port, that&#8217;s why it
called ssh forward I think.</p>

<p>You may note that I&#8217;m using the port 15100, that&#8217;s the mailcatcher web mananger port, I cannot access
the mailcatcher running on another machine, but somehow, I can ssh it through ssh port(22), so I asked
one of my <em>smart</em> colleagues, and got this solution.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/customize-matcher-by-using-hamcrest/">Customize Matcher by Using Hamcrest</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-15T22:24:00+08:00" pubdate data-updated="true">Oct 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>Although we can write tests all by the default matchers that hamcrest provided, but somehow we need the code to be more readable, and maintainable, so it&#8217;s a good way to try customize our own matchers.</p>

<p>We discussed how to TDD in last post, and in the book class we talked:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldGetBookInfo</span><span class="o">(){</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The Ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getName</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;The Ruby programming language&quot;</span><span class="o">));</span>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getCategory</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="s">&quot;Development&quot;</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>The default <em>is</em> matcher can get the job done, but not that readable, we can simply provide a customized matcher for this case:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldGetBookInfoByMatcher</span><span class="o">(){</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The Ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">book</span><span class="o">,</span> <span class="n">BookMatcher</span><span class="o">.</span><span class="na">isCorrect</span><span class="o">(</span><span class="s">&quot;The Ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Thanks for the flexibility of hamcrest, just extends the <em>BaseMatcher<T></em> like this:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">class</span> <span class="nc">BookMatcher</span> <span class="kd">extends</span> <span class="n">BaseMatcher</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">String</span> <span class="n">category</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">private</span> <span class="nf">BookMatcher</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">name</span> <span class="o">=</span> <span class="n">name</span><span class="o">;</span>
</span><span class='line'>        <span class="k">this</span><span class="o">.</span><span class="na">category</span> <span class="o">=</span> <span class="n">category</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">boolean</span> <span class="nf">matches</span><span class="o">(</span><span class="n">Object</span> <span class="n">item</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="o">(</span><span class="n">Book</span><span class="o">)</span><span class="n">item</span><span class="o">;</span>
</span><span class='line'>        <span class="k">return</span> <span class="n">book</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">&amp;&amp;</span> <span class="n">book</span><span class="o">.</span><span class="na">getCategory</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">category</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="nd">@Override</span>
</span><span class='line'>    <span class="kd">public</span> <span class="kt">void</span> <span class="nf">describeTo</span><span class="o">(</span><span class="n">Description</span> <span class="n">description</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="kd">static</span> <span class="n">BookMatcher</span> <span class="nf">isCorrect</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">,</span> <span class="n">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="k">new</span> <span class="nf">BookMatcher</span><span class="o">(</span><span class="n">name</span><span class="o">,</span> <span class="n">category</span><span class="o">);</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>



</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/simplified-tdd-by-using-interllij/">Simplified TDD by Using Intellij</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-15T20:42:00+08:00" pubdate data-updated="true">Oct 15<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><p>In my last <a href="">post</a>, I mentioned to how to setup a intellij project by using gradle. and today we are going to talk about how to using intellij to write a demo java project from scratch(right after the <em>gradle idea</em> command).</p>

<p>To begin with TDD in java, we need some packages for that:
-   junit
-   hamcrest</p>

<p>Let&#8217;s all of those dependencies in build.gradle:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='groovy'><span class='line'><span class="n">repositories</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">mavenCentral</span><span class="o">()</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="n">dependencies</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">testCompile</span> <span class="s1">&#39;junit:junit:4.8.2&#39;</span>
</span><span class='line'>    <span class="n">testCompile</span> <span class="s1">&#39;org.hamcrest:hamcrest-core:1.2.1&#39;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>and rerun the <em>gradle idea</em> command.</p>

<p>After intellij .ipr file generated, we can open it by intellij, and then create a project, let&#8217;s say the basic structure of the project is like this:</p>

<pre><code>└── src
    ├── main
    │   ├── java
    │   │   └── org
    │   │       └── icodeit
    │   │           └── library
    │   │               ├── Book.java
    │   │               └── Library.java
    │   └── resources
    └── test
        ├── java
        │   └── org
        │       └── icodeit
        │           └── library
        │               ├── BookTest.java
        │               └── LibraryTest.java
        └── resources
</code></pre>

<p>Basically, we are going to build a simple library which allow user to add/borrow/return books to/from.</p>

<p>We simply devide it to the following tasks:</p>

<ul>
<li>User can add book to library</li>
<li>User can get all books in a specific category</li>
<li>User can know how many books left in library</li>
<li>User can borrow book from library</li>
<li>User can return book when he/she finished</li>
<li>User can be told whether there are books he/she want left in library</li>
</ul>


<p>Let&#8217;s do it step by step, by following the TDD way. Of course, we need to add tests at vert first:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldAddBookToLibrary</span><span class="o">(){</span>
</span><span class='line'>    <span class="n">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Library</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getTotalBookNumber</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>This is a test used for test add book functionality, after the addition, we can tell by invoke <em>getTotalBookNumber</em> method (Of course, we need to make sure the project can be compiled, just add a new class Book.java and some fake methods in the Library.java). So, first we run the test (<em>Ctrl-Shift-F10</em>), and the test will fail.</p>

<p>Then we add the implementation of those functionalities:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kd">class</span> <span class="nc">Library</span> <span class="o">{</span>
</span><span class='line'>    <span class="kd">private</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">books</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="kd">public</span> <span class="nf">Library</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>        <span class="n">books</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="c1">//...</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">addBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">getTotalBookNumber</span><span class="o">()</span> <span class="o">{</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">books</span><span class="o">.</span><span class="na">size</span><span class="o">();</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Now we can get a green test. TDD is in a form of &#8220;Red-Green-Refactor&#8221;, so far we&#8217;ve got nothing to refactor, let&#8217;s add one more test:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldGetBooksByCategory</span><span class="o">(){</span>
</span><span class='line'>    <span class="n">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Library</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book1</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book2</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The python programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book3</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The lean startup&quot;</span><span class="o">,</span> <span class="s">&quot;Business&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="n">book1</span><span class="o">);</span>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="n">book2</span><span class="o">);</span>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="n">book3</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBookByCategory</span><span class="o">(</span><span class="s">&quot;Development&quot;</span><span class="o">).</span><span class="na">size</span><span class="o">(),</span> <span class="n">is</span><span class="o">(</span><span class="mi">2</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>Then the implementation:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">getBookByCategory</span><span class="o">(</span><span class="n">String</span> <span class="n">category</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">List</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;</span> <span class="n">grouped</span> <span class="o">=</span> <span class="k">new</span> <span class="n">LinkedList</span><span class="o">&lt;</span><span class="n">Book</span><span class="o">&gt;();</span>
</span><span class='line'>    <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span> <span class="o">:</span> <span class="n">books</span><span class="o">){</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getCategory</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">category</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">grouped</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">grouped</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>And what if the logic cames more complex, say:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="nd">@Test</span>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">shouldCanReturnBookToLibrary</span><span class="o">(){</span>
</span><span class='line'>    <span class="n">Library</span> <span class="n">library</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Library</span><span class="o">();</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">originBook</span> <span class="o">=</span> <span class="k">new</span> <span class="n">Book</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">,</span> <span class="s">&quot;Development&quot;</span><span class="o">);</span>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">addBook</span><span class="o">(</span><span class="n">originBook</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBookCount</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">Book</span> <span class="n">borrowed</span> <span class="o">=</span> <span class="n">library</span><span class="o">.</span><span class="na">borrowBook</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBookCount</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="mi">0</span><span class="o">));</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">library</span><span class="o">.</span><span class="na">returnBook</span><span class="o">(</span><span class="n">borrowed</span><span class="o">);</span>
</span><span class='line'>
</span><span class='line'>    <span class="n">assertThat</span><span class="o">(</span><span class="n">library</span><span class="o">.</span><span class="na">getBookCount</span><span class="o">(</span><span class="s">&quot;The ruby programming language&quot;</span><span class="o">),</span> <span class="n">is</span><span class="o">(</span><span class="mi">1</span><span class="o">));</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>When user borrowed a book from library, others can not borrow it any more of course, until the previous user return it back.</p>

<p>We can tell the specification by reading the test itself, and we don&#8217;t care about the code in this prespective. On the other hand, when we try to implement the logic, we can focus on the small piece of code and get it done:</p>

<figure class='code'><figcaption><span></span></figcaption><div class="highlight"><table><tr><td class="gutter"><pre class="line-numbers"><span class='line-number'>1</span>
<span class='line-number'>2</span>
<span class='line-number'>3</span>
<span class='line-number'>4</span>
<span class='line-number'>5</span>
<span class='line-number'>6</span>
<span class='line-number'>7</span>
<span class='line-number'>8</span>
<span class='line-number'>9</span>
<span class='line-number'>10</span>
<span class='line-number'>11</span>
<span class='line-number'>12</span>
<span class='line-number'>13</span>
<span class='line-number'>14</span>
<span class='line-number'>15</span>
<span class='line-number'>16</span>
<span class='line-number'>17</span>
<span class='line-number'>18</span>
<span class='line-number'>19</span>
<span class='line-number'>20</span>
<span class='line-number'>21</span>
<span class='line-number'>22</span>
<span class='line-number'>23</span>
<span class='line-number'>24</span>
<span class='line-number'>25</span>
<span class='line-number'>26</span>
<span class='line-number'>27</span>
<span class='line-number'>28</span>
<span class='line-number'>29</span>
<span class='line-number'>30</span>
</pre></td><td class='code'><pre><code class='java'><span class='line'><span class="kd">public</span> <span class="kt">int</span> <span class="nf">getBookCount</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="kt">int</span> <span class="n">bookCount</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span>
</span><span class='line'>    <span class="k">for</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span> <span class="o">:</span> <span class="n">books</span><span class="o">){</span>
</span><span class='line'>        <span class="k">if</span><span class="o">(</span><span class="n">book</span><span class="o">.</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">)){</span>
</span><span class='line'>            <span class="n">bookCount</span><span class="o">++;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>    <span class="k">return</span> <span class="n">bookCount</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="n">Book</span> <span class="nf">borrowBook</span><span class="o">(</span><span class="n">String</span> <span class="n">name</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">Book</span> <span class="n">book</span> <span class="o">=</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">if</span> <span class="o">(</span><span class="n">getBookCount</span><span class="o">(</span><span class="n">name</span><span class="o">)</span> <span class="o">==</span> <span class="mi">0</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">return</span> <span class="kc">null</span><span class="o">;</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">for</span> <span class="o">(</span><span class="kt">int</span> <span class="n">i</span> <span class="o">=</span> <span class="mi">0</span><span class="o">;</span> <span class="n">i</span> <span class="o">&lt;</span> <span class="n">books</span><span class="o">.</span><span class="na">size</span><span class="o">();</span> <span class="n">i</span><span class="o">++)</span> <span class="o">{</span>
</span><span class='line'>        <span class="k">if</span> <span class="o">(</span><span class="n">books</span><span class="o">.</span><span class="na">get</span><span class="o">(</span><span class="n">i</span><span class="o">).</span><span class="na">getName</span><span class="o">().</span><span class="na">equals</span><span class="o">(</span><span class="n">name</span><span class="o">))</span> <span class="o">{</span>
</span><span class='line'>            <span class="n">book</span> <span class="o">=</span> <span class="n">books</span><span class="o">.</span><span class="na">remove</span><span class="o">(</span><span class="n">i</span><span class="o">);</span>
</span><span class='line'>            <span class="k">break</span><span class="o">;</span>
</span><span class='line'>        <span class="o">}</span>
</span><span class='line'>    <span class="o">}</span>
</span><span class='line'>
</span><span class='line'>    <span class="k">return</span> <span class="n">book</span><span class="o">;</span>
</span><span class='line'><span class="o">}</span>
</span><span class='line'>
</span><span class='line'><span class="kd">public</span> <span class="kt">void</span> <span class="nf">returnBook</span><span class="o">(</span><span class="n">Book</span> <span class="n">book</span><span class="o">)</span> <span class="o">{</span>
</span><span class='line'>    <span class="n">books</span><span class="o">.</span><span class="na">add</span><span class="o">(</span><span class="n">book</span><span class="o">);</span>
</span><span class='line'><span class="o">}</span>
</span></code></pre></td></tr></table></div></figure>


<p>As you can see, the princple is really easy to follow:
-   Tasking (spearate the goal to some smaller parts)
-   Testing
-   Coding
-   Refactoring</p>

<p>The benefit is obverisly: there is no isolated code any more. Actually, the shorter of the code, the cleaner it will be.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/using-gradle-to-setup-standard-java-project/">Using Gradle to Setup Standard Java Project</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-12T23:24:00+08:00" pubdate data-updated="true">Oct 12<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>Generate typical project layout</h2>

<p>If you are as lazy as I am, you may want to generate typecial project layout automatically, let&#8217;s do it by using <a href="http://www.gradle.org/">gradle</a>.</p>

<p>Simply add the following lines into your build.gradle:</p>

<pre><code>apply plugin: 'java'

task "create-dirs" &lt;&lt; {
    sourceSets*.java.srcDirs*.each {it.mkdirs()}
    sourceSets*.resources.srcDirs*.each {it.mkdirs()}
}
</code></pre>

<p>then using gradle to run the task defined &#8220;create-dirs&#8221;:</p>

<pre><code>$ gradle create-dirs
</code></pre>

<p>you will get the directories structure like this:</p>

<pre><code>.
├── build.gradle
└── src
    ├── main
    │   ├── java
    │   └── resources
    └── test
        ├── java
        └── resources
</code></pre>

<p>If you are using intellij as your default IDE, then you can apply the &#8216;idea&#8217; plugin for the project:</p>

<pre><code>apply plugin: 'java'
apply plugin: 'idea'
</code></pre>

<p>and then:</p>

<pre><code>$ gradle idea
</code></pre>

<p>it should generate 3 files out: file.iml, file.ipr, file.iws. You can then open intellij and have fun with code inside, I would like to make a new post to talking about how to setup a java project by using intellij, and using <a href="http://en.wikipedia.org/wiki/Test-driven_development">TDD</a> for coding.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/how-to-embed-douban-show-in-your-octopress-site/">How to Embed Douban-Show in Your Octopress Site</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-10T21:08:00+08:00" pubdate data-updated="true">Oct 10<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h3>What do you need?</h3>

<ul>
<li>A valid douban account of course</li>
<li>octopress site</li>
</ul>


<h3>Step by step</h3>

<p>Let&#8217;s do it step by step:
Login your douban account at first, and then try to access this <a href="http://www.douban.com/service/badgemakerjs">link</a>, then you&#8217;ll prabobly get a similar script like this:</p>

<pre><code>&lt;script type="text/javascript" src="http://www.douban.com/service/badge/4023370/?show=collection&amp;amp;n=8&amp;amp;columns=2" &gt;&lt;/script&gt;
</code></pre>

<p>and then simply create a new file under the following path(in octopress repo):</p>

<pre><code>$ touch source/_includes/asides/douban.html
</code></pre>

<p>and then add the link you generated and fulfill it in the following structure:</p>

<p>finally, add the page path in <em>_config.html</em>:</p>

<pre><code>default_asides: [..., asides/douban.html, ...]
</code></pre>

<p>now you are done.</p>
</div>
  
  


    </article>
  
  
    <article>
      
  <header>
    
      <h1 class="entry-title"><a href="/2012/10/first-post-of-github-blog/">First Post of Github Blog (Powered by Octopress)</a></h1>
    
    
      <p class="meta">
        








  


<time datetime="2012-10-08T23:13:00+08:00" pubdate data-updated="true">Oct 8<span>th</span>, 2012</time>
        
      </p>
    
  </header>


  <div class="entry-content"><h2>What is Octopress anyway</h2>

<p>Here is a short description from <a href="http://octopress.org/">octopress.org</a>:</p>

<blockquote><p>   Octopress is a framework designed by Brandon Mathis for Jekyll, the blog aware static site generator powering Github Pages. To start blogging with Jekyll, you have to write your own HTML templates, CSS, Javascripts and set up your configuration. But with Octopress All of that is already taken care of. Simply clone or fork Octopress, install dependencies and the theme, and you’re set.</p></blockquote>

<h2>How to configure octopress</h2>

<p>The document presented by octopress itself is really great, you car refer <a href="http://octopress.org/docs/deploying/github/">How to deploying to github</a> for more details (as what I did).</p>

<h2>I found a weird issue when try to generate</h2>

<h3>FIX for Lion&#8217;s posix_spawn_ext.bundle: [BUG] Segmentation fault</h3>

<p>First delete the ruby</p>

<pre><code>rvm remove ruby-1.9.3 --gems --archive
</code></pre>

<p>then</p>

<pre><code>echo $CC
</code></pre>

<p>should return none.</p>

<p>finally, reinstall all stuff</p>

<pre><code>CC=/usr/bin/gcc-4.2 rvm install ruby-1.9.2
gem install bundler
bundle install
</code></pre>

<p>should fix the error.</p>
</div>
  
  


    </article>
  
  <div class="pagination">
    
      <a class="prev" href="/page/12/">&larr; Older</a>
    
    <a href="/blog/archives">Blog Archives</a>
    
    <a class="next" href="/page/10/">Newer &rarr;</a>
    
  </div>
</div>
<aside class="sidebar">
  
    <section>
  <h1>Recent Posts</h1>
  <ul id="recent_posts">
    
      <li class="post">
        <a href="/2018/06/real-time-data-visualization/">实时数据的可视化</a>
      </li>
    
      <li class="post">
        <a href="/2018/01/two-types-of-developer/">团队里的两类程序员</a>
      </li>
    
      <li class="post">
        <a href="/2018/01/feedback-saves-the-world/">反馈拯救世界</a>
      </li>
    
      <li class="post">
        <a href="/2017/08/from-sandwich-to-hexagon/">从三明治到六边形</a>
      </li>
    
      <li class="post">
        <a href="/2017/07/tips-for-newbies/">如何成为一名优秀的程序员？</a>
      </li>
    
  </ul>
</section>

  
</aside>

    </div>
  </div>
  <footer role="contentinfo"><p>
  Copyright &copy; 2018 - Qiu Juntao -
  <span class="credit">Powered by <a href="http://octopress.org">Octopress</a> | Themed with <a href="https://github.com/lucaslew/whitespace">Whitespace</a></span>
</p>

</footer>
  

<script type="text/javascript">
      var disqus_shortname = 'icodeit';
      
        
        var disqus_script = 'count.js';
      
    (function () {
      var dsq = document.createElement('script'); dsq.type = 'text/javascript'; dsq.async = true;
      dsq.src = 'http://' + disqus_shortname + '.disqus.com/' + disqus_script;
      (document.getElementsByTagName('head')[0] || document.getElementsByTagName('body')[0]).appendChild(dsq);
    }());
</script>














</body>
</html>
